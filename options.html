<!DOCTYPE HTML>
<html>
<head>
<title>kwitty options</title>
<link type="text/css" href="css/options.css" rel="stylesheet" />

<script type="text/javascript" src="js/jquery-1.7.min.js"></script>
<script type="text/javascript" src="js/config.js"></script>
<script type="text/javascript" src="js/woeid.js"></script>
<script type="text/javascript">

    var saveValue = function(elem, val) {
        if (val == undefined) {
            val = $(elem).val();
        }
        console.debug('v:', val, $(elem).val(), 't:', $(elem).text());
        var item = $(elem).prop('id').replace(/-/g, '.');
        config.saveValue(item, val);
        // notify main page
        chrome.extension.sendRequest({msg: 'update', item: item, value: val}, function(response) {
            if (response) {
                console.log('update value ok');
            }
        });
    };

    var loadValue = function(v, id) {
        if (typeof(v) == 'boolean') { // checkbox
            $('#'+id).prop('checked', v)
        } else if (/-imageFileName$/.test(id)) {
            $('#'+id).text(v)
        } else { // others
            $('#'+id).val(v)
        }
    };

    var loadValues = function(obj, id) {
        $.each(obj, function(k, v) {
            if (typeof(v) == 'object') {
                loadValues(v, id+k+'-') 
            } else {
                loadValue(v, id+k);
            } 
        })
    };

    $(function() {
        $('#navbar li').click(function() {
            $(this).addClass('navbar-item-selected');
            $(this).siblings().removeClass('navbar-item-selected');
            var pageID = '#' + $(this).prop('id').replace('Nav', '');
            $(pageID).siblings().hide();
            $(pageID).fadeIn();
        });

        woeid.countries.forEach(function(item, i) {
            $('#basics-trends-country').append('<option value="'+item.woeid+'">'+item.name+'</option>');
        });

        var insertTownsByCountry = function(id, save) {
            $('#basics-trends-town').html('<option value="0">--</option>');
            if (save) {
                $('#basics-trends-town').change();
            }
            if (id == '1') { // worldwide
                return;
            }

            woeid.towns.forEach(function(item, i) {
                if (Number(item.parentid) == id) {
                    $('#basics-trends-town').append('<option value="'+item.woeid+'">'+item.name+'</option>');
                }
            });
        }
     
        // select
        $('#refreshSection select, #themeSection select, #displaySection select, #trendsSection select').change(function() {
            saveValue(this);
        });

        // change towns and should be saved/notified after country
        $('#basics-trends-country').change(function() {
            insertTownsByCountry(this.value, true);
        });

        // input
        $('#basics-api-address').change(function() {
            var addr = $(this).val();
            if (!/^http[s]?:\/\//.test(addr)) {
                addr = 'http://' + addr;
            }
            $(this).val(encodeURI(addr));
            saveValue(this);
        });

        $('#bgImageData').change(function() {
            var file = this.files[0];
            if (!file) {
                return;
            }
            if(!/image\/\w+/.test(file.type)){
                alert('Not image file!');
                return;
            }

            $('#gui-background-imageFileName').text(file.name);
            saveValue('#gui-background-imageFileName', file.name);

            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function(e) {
                config.saveToLS('bgImgData', this.result);
                chrome.extension.sendRequest({msg: 'update', item: 'bgImgData', value: this.result}, function(response) {
                    console.log('update bgImgData ok')
                });
            };
        });

        $('#bgImageBrowse').click(function() {
            $('#bgImageData').click();
        });

        // checkbox
        $('#basics-refresh-autoload, #basics-refresh-disreadingload, #gui-display-compact, #gui-display-expandurl, #gui-display-rich').change(function() {
            saveValue(this, $(this).prop('checked'));
        });

        config.init();
        loadValues(config.get(), '');

        // after load
        insertTownsByCountry(config.get().basics.trends.country, false);
        loadValue(config.get().basics.trends.town, 'basics-trends-town');
    });
</script>
</head>

<body>
<div id="main-content">
    <div id="navbar-container">
         <h1 id="settings-title">kwitty options</h1>
         <ul id="navbar">
             <li id="basicsPageNav" class="navbar-item navbar-item-selected">Basics</li>
             <li id="guiPageNav" class="navbar-item">GUI</li>
             <br>
             <li id="helpPageNav" class="navbar-item">Help</li>
         </ul>
    </div>

    <div id="mainview">
        <div id="mainview-content">
            <div id="basicsPage" class="page">
                <h1>Basics</h1>
                <section id="refreshSection">
                    <h3>Refresh:</h3>
                    <div>
                        <div class="section-group">
                            <label class="web-content-select-label">
                                <span>Home:</span>
                                <select id="basics-refresh-home">
                                    <option value="1">1 min</option>
                                    <option value="2">2 min</option>
                                    <option value="3">3 min</option>
                                    <option value="5">5 min</option>
                                    <option value="10">10 min</option>
                                    <option value="20">20 min</option>
                                    <option value="30">30 min</option>
                                </select>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="web-content-select-label">
                                <span>Mentions:</span>
                                <select id="basics-refresh-mentions">
                                    <option value="1">1 min</option>
                                    <option value="2">2 min</option>
                                    <option value="3">3 min</option>
                                    <option value="5">5 min</option>
                                    <option value="10">10 min</option>
                                    <option value="20">20 min</option>
                                    <option value="30">30 min</option>
                                </select>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="web-content-select-label">
                                <span>Retweets:</span>
                                <select id="basics-refresh-retweets">
                                    <option value="1">1 min</option>
                                    <option value="2">2 min</option>
                                    <option value="3">3 min</option>
                                    <option value="5">5 min</option>
                                    <option value="10">10 min</option>
                                    <option value="20">20 min</option>
                                    <option value="30">30 min</option>
                                </select>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="web-content-select-label">
                                <span>Messages:</span>
                                <select id="basics-refresh-messages">
                                    <option value="1">1 min</option>
                                    <option value="2">2 min</option>
                                    <option value="3">3 min</option>
                                    <option value="5">5 min</option>
                                    <option value="10">10 min</option>
                                    <option value="20">20 min</option>
                                    <option value="30">30 min</option>
                                </select>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="web-content-select-label">
                                <span>Search:</span>
                                <select id="basics-refresh-search">
                                    <option value="1">1 min</option>
                                    <option value="2">2 min</option>
                                    <option value="3">3 min</option>
                                    <option value="5">5 min</option>
                                    <option value="10">10 min</option>
                                    <option value="20">20 min</option>
                                    <option value="30">30 min</option>
                                </select>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="web-content-select-label">
                                <span>Others:</span>
                                <select id="basics-refresh-others">
                                    <option value="1">1 min</option>
                                    <option value="2">2 min</option>
                                    <option value="3">3 min</option>
                                    <option value="5">5 min</option>
                                    <option value="10">10 min</option>
                                    <option value="20">20 min</option>
                                    <option value="30">30 min</option>
                                </select>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="checkbox">
                                <input id="basics-refresh-autoload" type="checkbox">
                                <span>Auto load new tweets</span>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="checkbox">
                                <input id="basics-refresh-disreadingload" type="checkbox">
                                <span>Disable new tweets auto loading when reading (not at top)</span>
                            </label>
                        </div>

                    </div>
                </section>

                <section id="apiSection">
                    <h3>API:</h3>
                    <div>
                        <div class="section-group">
                            <span>API Address:</span>
                            <input id="basics-api-address" type="url" />
                        </div>
                    </div>
                </section>

                <section id="trendsSection">
                    <h3>Trends:</h3>
                    <div>
                        <div class="section-group">
                            <span>Country:</span>
                            <select id="basics-trends-country">
                                <option value="1">Worldwide</option>
                            </select>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <span>Town:</span>
                            <select id="basics-trends-town">
                            </select>
                        </div>
                    </div>
                </section>
            </div>

            <div id="guiPage" class="page hidden">
                <h1>GUI</h1>
                <section id="backgroundSection">
                    <h3>Background:</h3>
                    <div>
                        <div class="section-group">
                            <span>Background image:</span>
                            <button id="bgImageBrowse">Browse...</button>
                            <span id="gui-background-imageFileName"></span>
                            <input id="bgImageData" type="file" />
                        </div>
                    </div>
                </section>
                <section id="themeSection">
                    <h3>Theme:</h3>
                    <div>
                        <div class="section-group">
                            <label class="web-content-select-label">
                                <span>Timeline theme:</span>
                                <select id="gui-theme-tltheme">
                                    <option value="UI lightness">UI lightness</option>
                                    <option value="UI darkness">UI darkness</option>
                                    <option value="Smoothness">Smoothness</option>
                                    <option value="Start">Start</option>
                                    <option value="Redmond">Redmond</option>
                                    <option value="Sunny">Sunny</option>
                                    <option value="Overcast">Overcast</option>
                                    <option value="Le Frog">Le Frog</option>
                                    <option value="Flick">Flick</option>
                                    <option value="Pepper Grinder">Pepper Grinder</option>
                                    <option value="Eggplant">Eggplant</option>
                                    <option value="Dark Hive">Dark Hive</option>
                                    <option value="Cupertino">Cupertino</option>
                                    <option value="South Street">South Street</option>
                                    <option value="Blitzer">Blitzer</option>
                                    <option value="Humanity">Humanity</option>
                                    <option value="Hot sneaks">Hot sneaks</option>
                                    <option value="Excite Bike">Excite Bike</option>
                                    <option value="Vader">Vader</option>
                                    <option value="Dot Luv">Dot Luv</option>
                                    <option value="Mint Choc">Mint Choc</option>
                                    <option value="Black Tie">Black Tie</option>
                                    <option value="Trontastic">Trontastic</option>
                                    <option value="Swanky Purse">Swanky Purse</option>
                                </select>
                            </label>
                        </div>
                    </div>
                </section>
                <section id="displaySection">
                    <h3>Display:</h3>
                    <div>
                        <div class="section-group">
                            <label class="checkbox">
                                <input id="gui-display-compact" type="checkbox">
                                <span>Use compact view when open as window</span>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="checkbox">
                                <input id="gui-display-expandurl" type="checkbox">
                                <span>Expand shortened URL</span>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="checkbox">
                                <input id="gui-display-rich" type="checkbox">
                                <span>Show rich content (photo, video etc.) inline</span>
                            </label>
                        </div>

                        <div class="section-group">
                            <label class="web-content-select-label">
                                <span>Timeline tab width:</span>
                                <select id="gui-display-tabwidth">
                                    <option value="Normal">Normal</option>
                                    <option value="Wider">Wider</option>
                                    <option value="Full">Full</option>
                                </select>
                            </label>
                        </div>
                    </div>
                </section>
            </div>

            <div id="helpPage" class="page hidden">
                <h1>Help</h1>
                <section id="faqSection">
                    <div>
                        <p><b>How to send direct message to someone?</b></p>
                        <p>Use "d username content" format in tweet box, note that the "Tweet" button will change to "Send".</p>
                        <br>
                        <p><b>How to find someone by username?</b></p>
                        <p>Use "f username" format in tweet box, note that the "Tweet" button will change to "Find".</p>
                        <br>
                        <p><b>How to search tweets with keyword?</b></p>
                        <p>Use "s keyword" format in tweet box, note that the "Tweet" button will change to "Search".</p>
                        <br>
                        <p><b>How to open favorites, lists and trends?</b></p>
                        <p>Click your profile image in the left-up corner to open extra menu(icon).</p>
                        <br>
                        <p><b>How to apply the compact view?</b></p>
                        <p>1. Check the option in "GUI - Display".</p>
                        <p>2. Right click the APP start icon and select "open as window".</p>
                        <p>3. Restart.</p>
                        <br>
                        <p><b>How to export/backup tweets?</b></p>
                        <p>1. Click "Export" in a user tab.</p>
                        <p>2. Wait the exporting progress to 100%.</p>
                        <p>3. Save the exported page as (all content) a single local file.</p>
                        <p>Note: There'll be max 3200 tweets limited by Twitter.</p>
                        <br>
                        <p><b>How to use API?</b></p>
                        <p>1. Go to <a href="http://kwittyapp.appspot.com/" target="_blank">kwittyapp.appspot.com</a> and sign in with Twitter.</p>
                        <p>2. Set your key of the API (don't set it same as your Twitter password).</p>
                        <p>3. Use your username and API key to sign in with API in kwitty.</p>
                        <br>
                        <p><b>My kwitty doesn't work!</b></p>
                        <p>Be sure your Chrome is upgraded to the latest version.</p>
                        <p>Or try to <button>RESET</button> the APP. It'll clear all local settings.</p>
                        <p>Still have trouble? Go to <a href="https://code.google.com/p/kwitty/issues/list" target="_blank">issues page</a> report bugs.</p>
                    </div>
                </section>
                <section id="tipsSection">
                    <div>
                        <p><b>Tips</b></p>
                        <p>The URL link will be detected automatically and be shortened to "t.co".</p>
                        <p>Click the black top bar to go to top.</p>
                    </div>
                </section>
            </div>            

        </div>
    </div>
</div>


</body>
</html>

